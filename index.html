<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂìàÂü∫ËÇâÂ§ßÈÄÉÊùÄ | Âπ∏Â≠òËÄÖÊ°£Ê°à</title>
    <script src="data.js"></script>
    <style>
        /* --- üåë ËßÜËßâÈ£éÊ†º (‰øùÊåÅ‰∏çÂèò) --- */
        :root {
            --bg: #080808;
            --card-bg: #111;
            --gold: #eebc51;
            --gold-dim: #8a6d2e;
            --red: #d32f2f;
            --red-glow: rgba(211, 47, 47, 0.4);
            --text-main: #e0e0e0;
        }

        body {
            background-color: var(--bg);
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-main);
            font-family: 'Segoe UI', 'Roboto', monospace;
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .hero { text-align: center; margin-bottom: 30px; padding-top: 10px; }
        h1 {
            margin: 0; font-size: 24px; font-weight: 800; letter-spacing: 2px;
            text-transform: uppercase;
            background: linear-gradient(180deg, #fff, #888);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .subtitle { 
            color: var(--gold); font-size: 10px; letter-spacing: 4px; 
            margin-top: 8px; text-transform: uppercase; opacity: 0.8; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .subtitle::before, .subtitle::after { content: ""; width: 30px; height: 1px; background: var(--gold-dim); }

        .cta-btn {
            background: rgba(238, 188, 81, 0.1); border: 1px solid var(--gold-dim);
            color: var(--gold); text-decoration: none; padding: 10px 25px;
            border-radius: 4px; font-size: 13px; font-weight: bold;
            transition: 0.3s; display: inline-block; margin-bottom: 25px;
        }
        .cta-btn:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold-dim); }

        .history-list { width: 100%; max-width: 450px; padding-bottom: 80px; }
        
        .match-card {
            background: var(--card-bg); border: 1px solid #222;
            margin-bottom: 12px; padding: 15px; 
            display: flex; align-items: center; justify-content: space-between;
            border-radius: 6px; cursor: pointer; position: relative; overflow: hidden;
            transition: all 0.2s ease;
        }
        .match-card:hover { transform: translateY(-2px); border-color: #444; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .card-left { display: flex; flex-direction: column; gap: 4px; }
        .card-id { font-size: 14px; font-weight: bold; color: #fff; }
        .card-prize { font-size: 11px; color: var(--gold-dim); }
        .tag-mode { font-size: 9px; padding: 2px 6px; background: #1a1a1a; color: #666; border: 1px solid #333; }

        /* Ê∏∏ÊàèÂºπÁ™ó */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
        
        .header-bar { 
            width: 100%; max-width: 360px; display: flex; justify-content: space-between; 
            padding-bottom: 10px; border-bottom: 1px solid #222; margin-bottom: 20px;
            font-size: 12px; color: var(--gold); font-family: monospace;
        }

        .map-wrapper { 
            position: relative; width: 340px; height: 340px; 
            background: #0b0b0b; border: 1px solid #333; padding: 5px;
            box-shadow: 0 0 50px rgba(0,0,0,0.7); 
        }

        .map-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            width: 100%; height: 100%; gap: 4px;
        }

        .room-cell {
            background: #141414; border: 1px solid #222;
            position: relative; display: flex; flex-wrap: wrap; 
            align-items: center; justify-content: center;
            transition: background 0.2s;
        }
        .room-label { position: absolute; top: 2px; left: 3px; font-size: 8px; color: #333; }
        
        .room-cell.purged { background: #300505 !important; border-color: #800; }
        .room-cell.target { border-color: var(--red); box-shadow: inset 0 0 10px rgba(211, 47, 47, 0.2); }

        .p-dot {
            width: 26px; height: 26px; background: #222; color: #aaa;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: bold; margin: 2px; border: 1px solid #444;
            z-index: 10; transition: 0.3s;
        }
        .p-dot.dead { background: #000; color: #333; border-color: #222; text-decoration: line-through; opacity: 0.6; transform: scale(0.8); }

        .hunter {
            position: absolute; width: 36px; height: 36px;
            background: var(--red); border-radius: 50%;
            box-shadow: 0 0 20px var(--red);
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; z-index: 99; color: #fff;
            transition: top 0.4s linear, left 0.4s linear; 
            pointer-events: none;
        }

        .console { 
            width: 340px; text-align: center; color: #444; font-family: monospace; 
            font-size: 10px; margin-top: 15px; min-height: 15px; letter-spacing: 1px;
        }
        
        .start-btn {
            margin-top: 25px; background: var(--red); color: #fff; border: none;
            padding: 12px 50px; font-weight: bold; font-size: 14px; letter-spacing: 2px; cursor: pointer;
            box-shadow: 0 0 20px var(--red-glow); 
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
            transition: 0.2s;
        }
        .start-btn:active { transform: scale(0.96); }
        .start-btn.hide { display: none; }

        /* ÁªìÁÆóÂ±Ç */
        .result-overlay { 
            display: none; position: absolute; top:0; left:0; width:100%; height:100%; 
            background: rgba(0,0,0,0.95); flex-direction: column; align-items: center; justify-content: center; 
            z-index: 200; animation: fadein 0.5s;
        }
        @keyframes fadein { from{opacity:0} to{opacity:1} }
    </style>
</head>
<body>

    <div class="hero">
        <h1>CS:GO BATTLE ROYALE</h1>
        <div class="subtitle">9ÊàøÈÄâ2 ¬∑ ÁªùÂ¢ÉÊ±ÇÁîü</div>
    </div>

    <a href="https://casego.cn/home?Code=HSR91" target="_blank" class="cta-btn">
        üéüÔ∏è ÂâçÂæÄ Casego ÂèÇ‰∏é
    </a>

    <div class="history-list" id="listArea"></div>

    <div class="modal" id="gameModal">
        <div class="header-bar">
            <div id="gid">ID: --</div>
            <div id="status">SYSTEM READY</div>
        </div>

        <div class="map-wrapper">
            <div class="map-grid" id="grid"></div>
            <div class="hunter" id="hunter" style="display:none">üëπ</div>
        </div>

        <div class="console" id="console">WAITING FOR AUTHORIZATION...</div>

        <button class="start-btn" id="btnStart" onclick="runSequence()">INITIATE</button>
        <button onclick="closeGame()" style="margin-top:20px;background:none;border:none;color:#333;cursor:pointer;font-size:10px">ABORT</button>

        <div class="result-overlay" id="resultScreen">
            <div style="font-size:50px; margin-bottom:15px" id="resIcon">üèÜ</div>
            <div style="color:var(--gold); font-size:18px; font-weight:bold; letter-spacing:2px" id="resTitle">SURVIVORS</div>
            <div style="color:#ccc; font-size:14px; margin-top:10px; text-align:center; line-height:1.6" id="resNames"></div>
            <div style="color:#555; font-size:10px; margin-top:20px; border-top:1px solid #333; padding-top:10px">REWARD</div>
            <div style="color:#888; font-size:12px; margin-top:2px" id="resPrize"></div>
            <button onclick="closeGame()" style="margin-top:30px; border:1px solid #333; background:none; color:#666; padding:8px 30px; border-radius:50px; cursor:pointer">CLOSE</button>
        </div>
    </div>

    <script>
        // --- ‰øÆÂ§çÁâàÈü≥ÊïàÂºïÊìé (Èò≤Âç°Ê≠ª) ---
        let audioCtx = null;
        function initAudio() {
            if (!audioCtx) {
                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                } catch(e) {
                    console.log("Audio init failed, muted.");
                }
            }
            if (audioCtx && audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playSfx(k) {
            if(!audioCtx) return;
            try {
                const t=audioCtx.currentTime, o=audioCtx.createOscillator(), g=audioCtx.createGain();
                o.connect(g); g.connect(audioCtx.destination);
                if(k==='step'){
                    o.frequency.setValueAtTime(80,t); o.frequency.exponentialRampToValueAtTime(40,t+0.1);
                    g.gain.setValueAtTime(0.05,t); g.gain.linearRampToValueAtTime(0,t+0.1);
                    o.start(t); o.stop(t+0.1);
                } else if(k==='purge'){
                    o.type='sawtooth'; o.frequency.setValueAtTime(120,t); o.frequency.exponentialRampToValueAtTime(10,t+0.4);
                    g.gain.setValueAtTime(0.2,t); g.gain.exponentialRampToValueAtTime(0,t+0.4);
                    o.start(t); o.stop(t+0.4);
                } else if(k==='win'){
                    o.type='sine'; o.frequency.setValueAtTime(440,t); g.gain.setValueAtTime(0.2,t); g.gain.exponentialRampToValueAtTime(0,t+2);
                    o.start(t); o.stop(t+2);
                }
            } catch(e) {
                console.warn("Audio Error:", e); // Èò≤Ê≠¢Èü≥ÊïàÊä•ÈîôÂç°‰Ωè‰∏ªÁ∫øÁ®ã
            }
        }
        function wait(ms){return new Promise(r=>setTimeout(r,ms))}
        function log(t) { document.getElementById('console').innerText = t; }

        let curGame = null;
        let hunterPos = 4;

        // Ê∏≤ÊüìÂàóË°®
        const listArea = document.getElementById('listArea');
        if(typeof gameHistory !== 'undefined'){
            gameHistory.slice().reverse().forEach(g => {
                const d = document.createElement('div');
                d.className = 'match-card';
                d.onclick = () => loadGame(g);
                d.innerHTML = `
                    <div class="card-left">
                        <div class="card-id">${g.id}</div>
                        <div class="card-prize">üì¶ ${g.prize}</div>
                    </div>
                    <div class="card-right"><span class="tag-mode">${g.type==='map_zone'?'ZONE':'CLASSIC'}</span></div>
                `;
                listArea.appendChild(d);
            });
        }

        function loadGame(g) {
            if(g.type !== 'map_zone') { alert("Please recreate data with Admin Tool"); return; }
            curGame = g;
            document.getElementById('gameModal').style.display = 'flex';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('gid').innerText = g.id;
            document.getElementById('status').innerText = "SYSTEM STANDBY";
            document.getElementById('btnStart').classList.remove('hide');
            initGrid(g);
        }

        function closeGame() { document.getElementById('gameModal').style.display = 'none'; }

        function initGrid(g) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for(let i=0; i<9; i++){
                const c = document.createElement('div');
                c.className = 'room-cell';
                c.id = `room-${i}`;
                c.innerHTML = `<span class="room-label">R${i+1}</span>`;
                grid.appendChild(c);
            }
            g.players.forEach((name, idx) => {
                const r = g.rooms[idx];
                const dot = document.createElement('div');
                dot.className = 'p-dot';
                dot.id = `p-${idx}`;
                dot.innerText = name[0];
                dot.title = name;
                const roomEl = document.getElementById(`room-${r}`);
                if(roomEl) roomEl.appendChild(dot);
            });
            hunterPos = 4;
            document.getElementById('hunter').style.display = 'none'; 
        }

        async function runSequence() {
            // ÂàùÂßãÂåñÈü≥È¢ë (ÂøÖÈ°ªÂú®ÁÇπÂáª‰∫ã‰ª∂ÂÜÖ)
            initAudio();

            // Èò≤Â¥©Ê∫ÉÂåÖË£π
            try {
                document.getElementById('btnStart').classList.add('hide');
                document.getElementById('status').innerText = "PURGE SEQUENCE ACTIVE";
                
                const h = document.getElementById('hunter');
                updateHunterPos(4); // ÂàùÂßã‰ΩçÁΩÆ
                h.style.display = 'flex';
                log("HUNTER DEPLOYED");
                await wait(1000);

                const seq = curGame.huntSequence || [];
                let localAlive = curGame.players.map(()=>true);

                for (let i = 0; i < seq.length; i++) {
                    const targetRoom = seq[i];
                    if(targetRoom === undefined) continue;

                    log(`TARGETING SECTOR ${targetRoom+1}...`);
                    
                    // ÂØªË∑ØÁßªÂä®
                    await moveHunterPath(targetRoom);

                    // Ê∏ÖÊ¥óÊàøÈó¥
                    playSfx('purge');
                    const roomEl = document.getElementById(`room-${targetRoom}`);
                    if(roomEl) roomEl.classList.add('purged');
                    
                    if(navigator.vibrate) navigator.vibrate(200);

                    // Âà§ÂÆöÊ≠ª‰∫°
                    let casualties = false;
                    curGame.players.forEach((n, idx) => {
                        if (curGame.rooms[idx] === targetRoom && localAlive[idx]) {
                            localAlive[idx] = false;
                            const pDot = document.getElementById(`p-${idx}`);
                            if(pDot) pDot.classList.add('dead');
                            casualties = true;
                        }
                    });

                    if(casualties) log(`CASUALTIES IN SECTOR ${targetRoom+1}`);
                    else log(`SECTOR ${targetRoom+1} CLEARED`);

                    await wait(600);
                }

                finishGame(localAlive);

            } catch (err) {
                console.error(err);
                log("SYSTEM ERROR: " + err.message);
                alert("ËøêË°åÂá∫ÈîôÔºåËØ∑Ê£ÄÊü• data.js Êï∞ÊçÆÊòØÂê¶Ê≠£Á°Æ");
            }
        }

        // ÁÆÄÂçïÁöÑ BFS ÂØªË∑Ø
        function getPath(start, end) {
            if(start===end) return [start];
            const adj = [[1,3],[0,2,4],[1,5],[0,4,6],[1,3,5,7],[2,4,8],[3,7],[4,6,8],[5,7]];
            let q = [[start]], v = new Set([start]);
            while(q.length){
                let path = q.shift();
                let last = path[path.length-1];
                if(last === end) return path;
                
                // ÂÆâÂÖ®Ê£ÄÊü•
                if(!adj[last]) return [end]; 

                for(let n of adj[last]){
                    if(!v.has(n)){ v.add(n); q.push([...path, n]); }
                }
            }
            return [end];
        }

        async function moveHunterPath(target) {
            const path = getPath(hunterPos, target);
            if(path.length < 2) return; // Â∑≤ÁªèÂú®ÂéüÂú∞

            for(let i=1; i<path.length; i++){
                playSfx('step');
                updateHunterPos(path[i]);
                await wait(300);
            }
        }

        function updateHunterPos(idx) {
            hunterPos = idx;
            const h = document.getElementById('hunter');
            const r = document.getElementById(`room-${idx}`);
            if(!r) return;
            
            // ‰ΩøÁî® CSS Transform ÁßªÂä®ÂèØËÉΩÊØî left/top Êõ¥Âπ≥ÊªëÔºå‰ΩÜËøôÈáå‰øùÊåÅÂéüÈÄªËæë
            const left = r.offsetLeft + r.offsetWidth/2 - 18;
            const top = r.offsetTop + r.offsetHeight/2 - 18;
            h.style.left = left + 'px';
            h.style.top = top + 'px';
            
            document.querySelectorAll('.room-cell').forEach(e=>e.classList.remove('target'));
            r.classList.add('target');
        }

        function finishGame(aliveState) {
            playSfx('win');
            const survivors = [];
            curGame.players.forEach((n, i) => {
                if(aliveState[i]) survivors.push(n);
            });

            const screen = document.getElementById('resultScreen');
            const icon = document.getElementById('resIcon');
            const title = document.getElementById('resTitle');
            const names = document.getElementById('resNames');
            const prize = document.getElementById('resPrize');

            screen.style.display = 'flex';
            prize.innerText = curGame.prize;

            if (survivors.length === 0) {
                icon.innerText = "üíÄ";
                title.innerText = "TOTAL WIPEOUT";
                title.style.color = "#d32f2f";
                names.innerText = "ÊâÄÊúâÂπ∏Â≠òËÄÖÂ∑≤Ë¢´Ê∏ÖÈô§\nÂ•ñÂìÅÂ∞ÜÁî±ÂÖ®ÂëòÁìúÂàÜ";
                names.style.color = "#888";
            } else {
                icon.innerText = "üèÜ";
                title.innerText = `SURVIVORS (${survivors.length})`;
                title.style.color = "#eebc51";
                names.innerText = survivors.join(" & ");
                names.style.color = "#fff";
            }
        }
    </script>
</body>
</html>
