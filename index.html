<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CS:GO ÁåéÊùÄÊ°£Ê°à</title>
    <script src="data.js"></script>
    <style>
        /* --- üåë ËµõÂçöÊàòÊúØÈ£éÊ†º (Tactical Dark) --- */
        :root {
            --bg: #050505;
            --panel: #0e0e0e;
            --border: #333;
            --gold: #ffb700;
            --cyan: #00f3ff; /* ÁßëÊäÄËìù */
            --red: #ff2a2a;
            --text-main: #d0d0d0;
            --text-dim: #666;
        }

        @font-face {
            font-family: 'TechMono';
            src: local('Consolas'), local('Courier New'), monospace;
        }

        body {
            background-color: var(--bg);
            /* Â§çÊùÇÁöÑÁΩëÊ†ºËÉåÊôØ */
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            color: var(--text-main);
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- CRT Êâ´ÊèèÁ∫øÊª§Èïú --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none; z-index: 999;
            opacity: 0.6;
        }

        /* --- È°∂ÈÉ® Hero --- */
        .hero { 
            width: 100%; padding: 30px 20px; text-align: center; 
            background: linear-gradient(180deg, rgba(0,243,255,0.05) 0%, transparent 100%);
            border-bottom: 1px solid #222; margin-bottom: 20px;
        }
        h1 {
            margin: 0; font-size: 24px; font-weight: 900; letter-spacing: 3px; color: #fff;
            text-shadow: 0 0 10px rgba(0,243,255,0.3); text-transform: uppercase;
        }
        .subtitle { 
            font-family: 'TechMono', monospace; font-size: 10px; color: var(--cyan); 
            margin-top: 5px; opacity: 0.8; letter-spacing: 1px;
        }

        /* --- ÂàóË°®Âå∫Âüü --- */
        .list-container { width: 100%; max-width: 480px; padding: 0 20px 80px 20px; box-sizing: border-box;}
        
        .match-card {
            background: rgba(20, 20, 20, 0.8); 
            border: 1px solid #222; border-left: 3px solid #444;
            margin-bottom: 10px; padding: 15px; 
            display: flex; align-items: center; justify-content: space-between;
            position: relative; cursor: pointer; backdrop-filter: blur(5px);
            transition: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .match-card:hover { 
            transform: translateX(5px); border-color: var(--cyan); 
            box-shadow: -5px 0 15px rgba(0,243,255,0.1); border-left-color: var(--cyan);
        }
        .match-card .info-top { font-size: 14px; color: #fff; font-weight: bold; margin-bottom: 4px; }
        .match-card .info-sub { font-size: 11px; color: var(--text-dim); font-family: 'TechMono', monospace; }
        .tag-hunter { 
            font-size: 9px; padding: 2px 6px; background: rgba(255, 42, 42, 0.1); 
            color: var(--red); border: 1px solid var(--red); border-radius: 2px;
        }
        .tag-classic { font-size: 9px; padding: 2px 6px; border: 1px solid #444; color: #666; }

        /* --- Ê∏∏ÊàèÁªàÁ´ØÂºπÁ™ó --- */
        .modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #000; z-index: 100; flex-direction: column; align-items: center; justify-content: center; 
        }

        /* HUD Â§¥ÈÉ® */
        .hud-header {
            width: 100%; max-width: 380px; margin-bottom: 20px; 
            border: 1px solid #333; background: #080808; padding: 10px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .hunter-badge {
            display: flex; align-items: center; gap: 8px;
            font-size: 12px; color: var(--red); font-weight: bold; text-transform: uppercase;
        }
        .hunter-badge::before { content: "üëπ"; font-size: 16px; }
        .game-id { font-family: 'TechMono', monospace; font-size: 10px; color: #555; }

        /* Âú∞ÂõæÂÆπÂô® */
        .map-frame {
            position: relative; width: 340px; height: 340px; 
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            border: 1px solid #333; padding: 5px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        /* ËßíËêΩË£ÖÈ•∞ */
        .map-frame::before { content:""; position:absolute; top:-1px; left:-1px; width:10px; height:10px; border-top:2px solid var(--cyan); border-left:2px solid var(--cyan); }
        .map-frame::after { content:""; position:absolute; bottom:-1px; right:-1px; width:10px; height:10px; border-bottom:2px solid var(--cyan); border-right:2px solid var(--cyan); }

        .map-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            width: 100%; height: 100%; gap: 2px;
        }

        .room-cell {
            background: #0e0e0e; border: 1px solid #1a1a1a;
            position: relative; display: flex; flex-wrap: wrap; 
            align-items: center; justify-content: center;
            transition: background 0.2s;
        }
        .room-label { position: absolute; top: 2px; left: 3px; font-size: 7px; color: #333; font-family: 'TechMono'; }
        
        .room-cell.purged { background: #1a0505 !important; border: 1px solid #500; box-shadow: inset 0 0 15px rgba(255,0,0,0.1); }
        .room-cell.target { border-color: var(--red); box-shadow: inset 0 0 10px rgba(211, 47, 47, 0.4); }

        /* Áé©ÂÆ∂Â§¥ÂÉè */
        .p-dot {
            width: 24px; height: 24px; background: #1a1a1a; color: #888;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: bold; margin: 2px; border: 1px solid #333;
            z-index: 10; transition: 0.3s;
        }
        .p-dot.dead { 
            background: #050505; color: #333; border-color: #222; 
            text-decoration: line-through; transform: scale(0.8); 
        }

        /* Â±†Â§´ */
        .hunter {
            position: absolute; width: 32px; height: 32px;
            background: rgba(255, 42, 42, 0.9); 
            border: 1px solid #fff; border-radius: 50%;
            box-shadow: 0 0 20px var(--red);
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; z-index: 99; color: #fff;
            transition: top 0.4s linear, left 0.4s linear; 
            pointer-events: none;
        }

        /* ÊéßÂà∂Âè∞‰∏éÊåâÈíÆ */
        .console { 
            width: 340px; text-align: center; color: var(--cyan); font-family: 'TechMono', monospace; 
            font-size: 10px; margin-top: 15px; min-height: 15px; text-shadow: 0 0 5px rgba(0,243,255,0.5);
        }
        
        .start-btn {
            margin-top: 25px; background: transparent; color: var(--red); 
            border: 1px solid var(--red);
            padding: 10px 40px; font-weight: bold; font-family: 'TechMono'; letter-spacing: 2px; 
            cursor: pointer; transition: 0.2s;
        }
        .start-btn:hover { background: var(--red); color: #000; box-shadow: 0 0 20px var(--red-glow); }
        .start-btn.hide { display: none; }

        /* ÁªìÁÆóÂºπÁ™ó */
        .result-overlay { 
            display: none; position: absolute; top:0; left:0; width:100%; height:100%; 
            background: rgba(0,0,0,0.92); backdrop-filter: blur(5px);
            flex-direction: column; align-items: center; justify-content: center; 
            z-index: 200; animation: fadein 0.5s;
        }
        
        .res-card {
            width: 80%; max-width: 300px; padding: 30px;
            background: #0e0e0e; border: 1px solid #333; text-align: center;
            box-shadow: 0 0 50px rgba(238, 188, 81, 0.1); position: relative;
        }
        .res-card::before { content:""; position:absolute; top:0; left:0; width:100%; height:2px; background: var(--gold); }

        .res-list { color: #fff; font-size: 14px; margin: 15px 0; line-height: 1.6; }
        .res-hunter { color: var(--red); font-weight: bold; font-size: 16px; margin-bottom: 5px; display:block;}
        .res-label { font-size: 9px; color: #555; letter-spacing: 1px; margin-top: 15px; text-transform: uppercase; }

        @keyframes fadein { from{opacity:0} to{opacity:1} }
    </style>
</head>
<body>
    
    <div class="scanlines"></div>

    <div class="hero">
        <h1>PROJECT: HUNTER</h1>
        <div class="subtitle">ASYMMETRIC SURVIVAL PROTOCOL</div>
    </div>

    <div class="list-container" id="listArea"></div>

    <!-- Ê∏∏ÊàèÂºπÁ™ó -->
    <div class="modal" id="gameModal">
        <div class="hud-header">
            <div class="hunter-badge" id="hudHunter">HUNTER: ???</div>
            <div class="game-id" id="hudId">ID: --</div>
        </div>

        <div class="map-frame">
            <div class="map-grid" id="grid"></div>
            <div class="hunter" id="hunter" style="display:none">‚ò†Ô∏è</div>
        </div>

        <div class="console" id="console">SYSTEM ONLINE. WAITING FOR INPUT.</div>

        <button class="start-btn" id="btnStart" onclick="runSequence()">EXECUTE</button>
        <button onclick="closeGame()" style="margin-top:20px;background:none;border:none;color:#333;cursor:pointer;font-family:'TechMono';font-size:10px">TERMINATE SESSION</button>

        <div class="result-overlay" id="resultScreen">
            <div class="res-card">
                <div style="font-size:40px; margin-bottom:10px">üèÜ</div>
                <div style="color:var(--gold); font-size:12px; letter-spacing:2px; font-weight:bold">WINNERS</div>
                
                <div class="res-list">
                    <span id="resHunter" class="res-hunter"></span>
                    <span id="resSurvivors"></span>
                </div>

                <div class="res-label">REWARD POOL</div>
                <div style="color:#888; font-size:11px; margin-top:2px" id="resPrize"></div>

                <button onclick="closeGame()" style="margin-top:25px; border:1px solid #333; background:transparent; color:#666; padding:8px 30px; cursor:pointer; font-family:'TechMono'; font-size:10px;">DISMISS</button>
            </div>
        </div>
    </div>

    <script>
        // Èü≥ÊïàÁ≥ªÁªü
        let audioCtx = null;
        function initAudio() {
            if (!audioCtx) { try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e){} }
            if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playSfx(k) {
            if(!audioCtx) return;
            try {
                const t=audioCtx.currentTime, o=audioCtx.createOscillator(), g=audioCtx.createGain();
                o.connect(g); g.connect(audioCtx.destination);
                if(k==='step'){
                    o.frequency.setValueAtTime(60,t); o.frequency.exponentialRampToValueAtTime(30,t+0.1);
                    g.gain.setValueAtTime(0.05,t); g.gain.linearRampToValueAtTime(0,t+0.1);
                    o.start(t); o.stop(t+0.1);
                } else if(k==='purge'){
                    o.type='sawtooth'; o.frequency.setValueAtTime(100,t); o.frequency.exponentialRampToValueAtTime(10,t+0.5);
                    g.gain.setValueAtTime(0.15,t); g.gain.exponentialRampToValueAtTime(0,t+0.5);
                    o.start(t); o.stop(t+0.5);
                } else if(k==='win'){
                    o.type='triangle'; o.frequency.setValueAtTime(400,t); g.gain.setValueAtTime(0.1,t); g.gain.exponentialRampToValueAtTime(0,t+1.5);
                    o.start(t); o.stop(t+1.5);
                }
            } catch(e){}
        }
        function wait(ms){return new Promise(r=>setTimeout(r,ms))}
        function log(t) { document.getElementById('console').innerText = t; }

        let curGame = null;
        let hunterPos = 4;

        // Ê∏≤ÊüìÂàóË°®
        const listArea = document.getElementById('listArea');
        if(typeof gameHistory !== 'undefined'){
            gameHistory.slice().reverse().forEach(g => {
                const d = document.createElement('div');
                d.className = 'match-card';
                d.onclick = () => loadGame(g);
                
                let tagClass = 'tag-classic';
                let tagText = 'CLASSIC';
                if (g.type === 'map_hunter') { tagClass = 'tag-hunter'; tagText = 'HUNTER MODE'; }
                else if (g.type === 'map_zone') { tagClass = 'tag-classic'; tagText = 'ZONE'; }

                d.innerHTML = `
                    <div class="card-left">
                        <div class="info-top">${g.id}</div>
                        <div class="info-sub">üì¶ ${g.prize}</div>
                    </div>
                    <div class="card-right">
                        <span class="${tagClass}">${tagText}</span>
                    </div>
                `;
                listArea.appendChild(d);
            });
        }

        function loadGame(g) {
            // ÂÖºÂÆπÊóßÁöÑ map_zone
            if(g.type !== 'map_hunter' && g.type !== 'map_zone') { alert("Legacy data not supported"); return; }
            curGame = g;
            
            document.getElementById('gameModal').style.display = 'flex';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('hudId').innerText = "ID: " + g.id.split('-')[0]; // ÁÆÄÁü≠ID
            document.getElementById('hudHunter').innerText = "HUNTER: " + (g.hunter || "AI SYSTEM");
            
            document.getElementById('console').innerText = "CONNECTION ESTABLISHED";
            document.getElementById('btnStart').classList.remove('hide');
            initGrid(g);
        }

        function closeGame() { document.getElementById('gameModal').style.display = 'none'; }

        function initGrid(g) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for(let i=0; i<9; i++){
                const c = document.createElement('div');
                c.className = 'room-cell';
                c.id = `room-${i}`;
                c.innerHTML = `<span class="room-label">R${i+1}</span>`;
                grid.appendChild(c);
            }
            g.players.forEach((name, idx) => {
                const r = g.rooms[idx];
                const dot = document.createElement('div');
                dot.className = 'p-dot';
                dot.id = `p-${idx}`;
                dot.innerText = name[0];
                dot.title = name;
                document.getElementById(`room-${r}`).appendChild(dot);
            });
            hunterPos = 4;
            document.getElementById('hunter').style.display = 'none'; 
        }

        async function runSequence() {
            initAudio();
            try {
                document.getElementById('btnStart').classList.add('hide');
                log("SEQUENCE INITIATED...");
                
                const h = document.getElementById('hunter');
                updateHunterPos(4);
                h.style.display = 'flex';
                await wait(1000);

                const seq = curGame.huntSequence || [];
                let localAlive = curGame.players.map(()=>true);

                for (let i = 0; i < seq.length; i++) {
                    const targetRoom = seq[i];
                    log(`PURGING SECTOR ${targetRoom+1}...`);
                    
                    await moveHunterPath(targetRoom);

                    playSfx('purge');
                    const roomEl = document.getElementById(`room-${targetRoom}`);
                    roomEl.classList.add('purged');
                    
                    if(navigator.vibrate) navigator.vibrate(100);

                    let kill = false;
                    curGame.players.forEach((n, idx) => {
                        if (curGame.rooms[idx] === targetRoom && localAlive[idx]) {
                            localAlive[idx] = false;
                            const pDot = document.getElementById(`p-${idx}`);
                            if(pDot) pDot.classList.add('dead');
                            kill = true;
                        }
                    });

                    await wait(600);
                }

                log("SEQUENCE COMPLETE");
                await wait(500);
                finishGame(localAlive);

            } catch (err) { console.error(err); }
        }

        // BFS ÂØªË∑Ø
        function getPath(start, end) {
            if(start===end) return [start];
            const adj = [[1,3],[0,2,4],[1,5],[0,4,6],[1,3,5,7],[2,4,8],[3,7],[4,6,8],[5,7]];
            let q = [[start]], v = new Set([start]);
            while(q.length){
                let p = q.shift(), l = p[p.length-1];
                if(l === end) return p;
                if(adj[l]) for(let n of adj[l]) if(!v.has(n)){ v.add(n); q.push([...p, n]); }
            }
            return [end];
        }

        async function moveHunterPath(target) {
            const path = getPath(hunterPos, target);
            if(path.length < 2) return; 
            for(let i=1; i<path.length; i++){
                playSfx('step');
                updateHunterPos(path[i]);
                await wait(250);
            }
        }

        function updateHunterPos(idx) {
            hunterPos = idx;
            const h = document.getElementById('hunter');
            const r = document.getElementById(`room-${idx}`);
            // ËÆ°ÁÆó‰∏≠ÂøÉ
            const left = r.offsetLeft + r.offsetWidth/2 - 16;
            const top = r.offsetTop + r.offsetHeight/2 - 16;
            h.style.left = left + 'px';
            h.style.top = top + 'px';
            
            document.querySelectorAll('.room-cell').forEach(e=>e.classList.remove('target'));
            r.classList.add('target');
        }

        function finishGame(aliveState) {
            playSfx('win');
            const survivors = [];
            curGame.players.forEach((n, i) => { if(aliveState[i]) survivors.push(n); });

            const screen = document.getElementById('resultScreen');
            document.getElementById('resPrize').innerText = curGame.prize;
            
            // ËÆæÁΩÆËµ¢ÂÆ∂ÔºöËøΩÁåéËÄÖ + Âπ∏Â≠òËÄÖ
            const hunterName = curGame.hunter || "System";
            document.getElementById('resHunter').innerText = "üëπ " + hunterName;

            if (survivors.length === 0) {
                document.getElementById('resSurvivors').innerText = "(No Survivors)";
                document.getElementById('resSurvivors').style.color = "#666";
            } else {
                document.getElementById('resSurvivors').innerText = "+ " + survivors.join(" & ");
                document.getElementById('resSurvivors').style.color = "#fff";
            }

            screen.style.display = 'flex';
        }
    </script>
</body>
</html>
